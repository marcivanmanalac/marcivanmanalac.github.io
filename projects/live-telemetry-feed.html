<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Live Telemetry Feed | Marc Ivan Manalac | Professional Portfolio">
    <meta name="description" content="">
    <meta name="image" content="https://github.com/marcivanmanalac.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Marc Ivan Manalac | Professional Portfolio">
    <meta property="og:url" content="https://marcivanmanalac.github.io/projects/live-telemetry-feed.html">
    <meta property="og:title" content="Live Telemetry Feed | Marc Ivan Manalac | Professional Portfolio">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://github.com/marcivanmanalac.png">
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/techfolio-theme/my_theme.css">
    <link rel="stylesheet" type="text/css" href="/css/rouge/molokai.css">
    <!-- Load MathJax if 'mathjax: true' is found in your _config.yml. -->
    
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML">
    </script>
    

    <title>Live Telemetry Feed | Marc Ivan Manalac | Professional Portfolio</title>
  </head>
  <body>
  <header class="navbar navbar-expand navbar-light bg-light bg-gradient border-bottom">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Marc Ivan Manalac</a>
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <a class="nav-link" href="/#projects">Projects</a>
        <a class="nav-link" href="/#essays">Essays</a>
        <a class="nav-link" href="/resume.html">Resume</a>
      </ul>
    </div>
  </div>
</header>

<div class="container py-4">
  <h1 class="display-4">Live Telemetry Feed</h1>
 <h2 id="summer-internship-2022">Summer Internship 2022</h2>
<p>During the Summer of 2022, I interned for NIWC Pacificâ€™s Unmanned Aerial Vehicle(UAS) team to assist with their ongoing drone projects. One of their tasks were to mount a sensor attached to a computer onto the drone and have it interface with the flight controller to send live telemetry data from that sensor to the ground control station. The true value of this was to have the ability to give the computer the ability to equip any sensor and process the data before sending it downstream to a remote user on the ground. My role was to solve this problem.</p>

<h3 id="challenges">Challenges</h3>
<p>The first challenge was understanding the devices I was to work on. I did research on open source software for flight controllers, the peripheral components that made up a drone, the language they spoke in, and tools and resources available to me for the process. I came up with a surface level understanding of what makes the UAS fly and how to communicate with it. Luckily for me, the systems we were using for the Autopilot(AP), Ground Control Station(GCS), and related hardware was well documented in the <a href="https://docs.px4.io/main/en/">PX4</a> and <a href="https://ardupilot.org/dev/index.html">ArduPilot</a> websites. Both sources also offered a large community for support for hobbyist and companies alike.</p>

<div class="text-center p-4">
  <div class="zoom-within-container">
    <img width="300px" height="300px" class="img-thumbnail" src="https://docs.px4.io/main/assets/img/logo_pro_small.e0fa34bd.png" />
    <img width="300px" height="300px" class="img-thumbnail" src="https://ardupilot.org/dev/_static/ardupilot_logo.png" />
    <img width="300px" height="400px" class="img-thumbnail" src="https://mavlink.io/assets/site/logo_mavlink_small.png" />
  </div>
</div>

<p>Second, I needed to create a program that can log the data from the sensor to the raspberry pi. Through the documentation of the sensor I was able to configure it to transmit a specific size and timeframe for the data. I also used python to create a new file, read, and write the incoming data each time it was executed. The data also needed to be in tranlsated into the native language of the UAS known as the MAVLink protocol. To do this, I utilized the serial library to establish a read in the sensor data and the pymavlink library to create a mavlink connection with the GCS, encode the data into the appropriate protocol and transfer broadcast it via UDP.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Naming and creating file for Sensor Log
</span><span class="n">dt</span> <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%Y_%m_%d_%H_%M_%S"</span><span class="p">))</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">'SENSOR_SAMPLE'</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">+</span><span class="s">'.txt'</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="c1">#Set Up Serial Port for the sensor
</span><span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="p">.</span><span class="n">Serial</span><span class="p">(</span>
        <span class="s">'/dev/ttyACM0'</span><span class="p">,</span>
        <span class="n">baudrate</span> <span class="o">=</span> <span class="mi">115200</span><span class="p">,</span>
        <span class="n">parity</span><span class="o">=</span><span class="n">serial</span><span class="p">.</span><span class="n">PARITY_NONE</span><span class="p">,</span>
        <span class="n">stopbits</span><span class="o">=</span><span class="n">serial</span><span class="p">.</span><span class="n">STOPBITS_ONE</span><span class="p">,</span>
        <span class="n">bytesize</span><span class="o">=</span><span class="n">serial</span><span class="p">.</span><span class="n">EIGHTBITS</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="c1"># Setup MAVLink to connect on udp 127.0.0.1:14550
</span><span class="n">conn</span> <span class="o">=</span> <span class="n">mavutil</span><span class="p">.</span><span class="n">mavlink_connection</span><span class="p">(</span><span class="s">"udp:127.0.0.1:14550"</span><span class="p">,</span> <span class="n">autoreconnect</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">source_system</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                  <span class="n">force_connected</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">source_component</span><span class="o">=</span><span class="n">mavutil</span><span class="p">.</span><span class="n">mavlink</span><span class="p">.</span><span class="n">MAV_COMP_ID_PERIPHERAL</span><span class="p">)</span>
<span class="c1"># wait for the heartbeat msg to find the system ID
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">conn</span><span class="p">.</span><span class="n">wait_heartbeat</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Got a heartbeat from remote MAVLink device, good to continue
</span>        <span class="k">break</span>
<span class="c1">#The program will continue to write into the file until it is terminated.
</span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="c1"># convert from bytes to string then strip any whitespace
</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">ser</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="s">''</span><span class="p">:</span>
        <span class="c1">#debugs printer
</span>        <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#writes to MAVLink as a STATUSTEXT message, encoded as ASCII
</span>        <span class="n">conn</span><span class="p">.</span><span class="n">mav</span><span class="p">.</span><span class="n">statustext_send</span><span class="p">(</span><span class="n">mavutil</span><span class="p">.</span><span class="n">mavlink</span><span class="p">.</span><span class="n">MAV_SEVERITY_INFO</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>Then finally, used a <a href="https://github.com/mavlink-router/mavlink-router">MAVLink Router</a> command inside of a bash script to transmit the data from the Pi to the flight controller via mavlink.</p>

<h3 id="results">Results</h3>
<p>I was given a <a href="https://anemoment.com/features/">Trisonica mini weather sensor</a> to use as the first device to test, along with a <a href="https://www.raspberrypi.com/products/raspberry-pi-zero/">Raspberry Pi Zero</a>, and an <a href="https://mrobotics.io/docs/mro-x2-1-rev2/">mro x2.1 flight controller</a> and was able to display the data on the GCS as obstructed upon running the bash script on the onboard companion computer. My next step now is to be able to collect the data outside of the GCS and plot data using a python script so we can visualize the live telemtry using data science. While there are some setbacks and difficulties with this next step, I am excited to continue working on the project and learn more about open source drones!</p>
<div class="text-center p-4">
    <div class="zoom-within-container">
    <img width="500px" height="500px" class="img-thumbnail" src="../img/live-telem-feed/tsm-pic.jpg" />
    <img width="500px" height="500px" class="img-thumbnail" src="../img/live-telem-feed/telem-data-gcs.jpg" />
  </div>
</div>

</div>

<footer class="navbar navbar-expand navbar-light bg-light bg-gradient border-top">
  <div class="container-fluid">
    <div class="ms-auto">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <small><a class="nav-link" href="https://techfolios.github.io">Made with Techfolios</a></small>
      </ul>
    </div>
  </div>
</footer>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  </body>
</html>
